{
  "id": "invoiceitems",
  "title": "Invoice Items",
  "description": "Manages individual billable items linked to invoices, including consultations, medicines, lab tests, and services.",
  "route": "/billing/invoiceitems",
  "icon": "ListOrdered",
  "entity": "InvoiceItem",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant", "BillingStaff"],
    "create": ["Admin", "BillingStaff"],
    "edit": ["Admin", "BillingStaff"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/invoiceitems",
    "get": "/api/invoiceitems/:id",
    "create": "/api/invoiceitems",
    "update": "/api/invoiceitems/:id",
    "delete": "/api/invoiceitems/:id"
  },

  "fields": [
    {
      "name": "id",
      "label": "Item ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "invoiceId",
      "label": "Invoice Reference",
      "type": "relation",
      "relationEntity": "invoices",
      "relationField": "invoiceNumber",
      "required": true,
      "showInList": true
    },
    {
      "name": "itemType",
      "label": "Item Type",
      "type": "enum",
      "options": ["CONSULTATION", "LAB_TEST", "MEDICINE", "SERVICE", "ROOM_CHARGE", "OTHER"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "description",
      "label": "Description",
      "type": "string",
      "placeholder": "Name or details of the billed service/item",
      "required": true,
      "showInList": true
    },
    {
      "name": "quantity",
      "label": "Quantity",
      "type": "number",
      "default": 1,
      "min": 1,
      "showInList": true
    },
    {
      "name": "unitPrice",
      "label": "Unit Price",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "discount",
      "label": "Discount (%)",
      "type": "number",
      "default": 0,
      "max": 100,
      "showInList": true
    },
    {
      "name": "taxRate",
      "label": "Tax Rate (%)",
      "type": "number",
      "default": 0,
      "showInList": true
    },
    {
      "name": "totalAmount",
      "label": "Total Amount",
      "type": "currency",
      "computed": "quantity * unitPrice * (1 - discount/100) * (1 + taxRate/100)",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["BILLED", "PAID", "REFUNDED"],
      "default": "BILLED",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "invoices",
      "type": "ManyToOne",
      "foreignKey": "invoiceId"
    }
  ],

  "ui": {
    "listView": {
      "title": "Invoice Items List",
      "columns": ["invoiceId", "itemType", "description", "quantity", "unitPrice", "totalAmount", "status"],
      "filters": ["itemType", "status"],
      "searchFields": ["description"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Add / Edit Invoice Item",
      "layout": [
        ["invoiceId", "itemType"],
        ["description"],
        ["quantity", "unitPrice"],
        ["discount", "taxRate"],
        ["status"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Invoice Item Details",
      "sections": [
        {
          "title": "Item Details",
          "fields": ["itemType", "description", "quantity", "unitPrice", "discount", "taxRate", "totalAmount"]
        },
        {
          "title": "Invoice Link",
          "fields": ["invoiceId"]
        },
        {
          "title": "Timestamps",
          "fields": ["createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "markPaid",
      "label": "Mark as Paid",
      "type": "update",
      "endpoint": "/api/invoiceitems/:id/status",
      "method": "PUT",
      "payload": { "status": "PAID" },
      "successMessage": "Invoice item marked as paid."
    },
    {
      "id": "refundItem",
      "label": "Refund Item",
      "type": "update",
      "endpoint": "/api/invoiceitems/:id/status",
      "method": "PUT",
      "payload": { "status": "REFUNDED" },
      "successMessage": "Invoice item refunded successfully."
    }
  ],

  "reasoning": {
    "businessLogic": "Each invoice item contributes to total billing and audit accuracy. It allows breakdown of charges by service, medicine, and tax calculation for compliance.",
    "uiLogic": "A detailed itemized list view ensures transparency. Computed fields dynamically calculate totals and apply tax/discount logic, reducing manual errors."
  }
}
