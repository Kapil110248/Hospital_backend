{
  "id": "payments",
  "title": "Payment Management",
  "description": "Tracks all payments made against invoices, including payment methods, reference numbers, and payer information.",
  "route": "/billing/payments",
  "icon": "CreditCard",
  "entity": "Payment",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant", "BillingStaff"],
    "create": ["Admin", "BillingStaff"],
    "edit": ["Admin", "Accountant"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/payments",
    "get": "/api/payments/:id",
    "create": "/api/payments",
    "update": "/api/payments/:id",
    "delete": "/api/payments/:id"
  },

  "fields": [
    {
      "name": "id",
      "label": "Payment ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "invoiceId",
      "label": "Invoice Reference",
      "type": "relation",
      "relationEntity": "invoices",
      "relationField": "invoiceNumber",
      "required": true,
      "showInList": true
    },
    {
      "name": "patientId",
      "label": "Patient",
      "type": "relation",
      "relationEntity": "patients",
      "relationField": "fullName",
      "required": true,
      "showInList": true
    },
    {
      "name": "amountPaid",
      "label": "Amount Paid",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "paymentMode",
      "label": "Payment Mode",
      "type": "enum",
      "options": ["CASH", "CARD", "UPI", "BANK_TRANSFER", "CHEQUE"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "transactionRef",
      "label": "Transaction Reference",
      "type": "string",
      "placeholder": "Transaction ID / Cheque No / UPI Ref",
      "showInList": true
    },
    {
      "name": "paymentDate",
      "label": "Payment Date",
      "type": "datetime",
      "required": true,
      "showInList": true
    },
    {
      "name": "receivedBy",
      "label": "Received By (Staff)",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "email",
      "required": true,
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["PENDING", "CONFIRMED", "FAILED", "REFUNDED"],
      "default": "CONFIRMED",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "remarks",
      "label": "Remarks / Notes",
      "type": "text",
      "placeholder": "Any additional payment notes",
      "showInList": false
    },
    {
      "name": "attachment",
      "label": "Receipt / Proof of Payment",
      "type": "file",
      "multiple": false,
      "showInList": false
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "invoices",
      "type": "ManyToOne",
      "foreignKey": "invoiceId"
    },
    {
      "entity": "patients",
      "type": "ManyToOne",
      "foreignKey": "patientId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "receivedBy"
    }
  ],

  "ui": {
    "listView": {
      "title": "Payments List",
      "columns": ["invoiceId", "patientId", "amountPaid", "paymentMode", "status", "paymentDate"],
      "filters": ["paymentMode", "status"],
      "searchFields": ["transactionRef", "patientId"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Record Payment",
      "layout": [
        ["invoiceId", "patientId"],
        ["amountPaid", "paymentMode"],
        ["transactionRef"],
        ["paymentDate"],
        ["receivedBy", "status"],
        ["remarks"],
        ["attachment"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Payment Details",
      "sections": [
        {
          "title": "Payment Info",
          "fields": ["invoiceId", "patientId", "amountPaid", "paymentMode", "transactionRef", "status"]
        },
        {
          "title": "Processing & Audit",
          "fields": ["receivedBy", "paymentDate", "remarks", "attachment"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "markRefunded",
      "label": "Mark as Refunded",
      "type": "update",
      "endpoint": "/api/payments/:id/status",
      "method": "PUT",
      "payload": { "status": "REFUNDED" },
      "successMessage": "Payment marked as refunded successfully."
    },
    {
      "id": "markConfirmed",
      "label": "Confirm Payment",
      "type": "update",
      "endpoint": "/api/payments/:id/status",
      "method": "PUT",
      "payload": { "status": "CONFIRMED" },
      "successMessage": "Payment confirmed successfully."
    }
  ],

  "reasoning": {
    "businessLogic": "Payments directly link with invoices and patients, ensuring accurate billing reconciliation and cash flow tracking. Each transaction includes reference IDs and audit history.",
    "uiLogic": "The UI supports multiple payment modes with validation and quick filters by status. Uploaded receipts ensure transparency and traceability of payments."
  }
}
