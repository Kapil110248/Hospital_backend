{
  "id": "refunds",
  "title": "Refund Management",
  "description": "Handles refund transactions for patients related to cancelled services, returned medicines, or billing adjustments.",
  "route": "/billing/refunds",
  "icon": "RotateCcw",
  "entity": "Refund",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant", "BillingStaff"],
    "create": ["Admin", "Accountant"],
    "edit": ["Admin", "Accountant"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/refunds",
    "get": "/api/refunds/:id",
    "create": "/api/refunds",
    "update": "/api/refunds/:id",
    "delete": "/api/refunds/:id"
  },

  "fields": [
    {
      "name": "id",
      "label": "Refund ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "invoiceId",
      "label": "Invoice Reference",
      "type": "relation",
      "relationEntity": "invoices",
      "relationField": "invoiceNumber",
      "required": true,
      "showInList": true
    },
    {
      "name": "paymentId",
      "label": "Payment Reference",
      "type": "relation",
      "relationEntity": "payments",
      "relationField": "id",
      "required": true,
      "showInList": true
    },
    {
      "name": "patientId",
      "label": "Patient",
      "type": "relation",
      "relationEntity": "patients",
      "relationField": "fullName",
      "required": true,
      "showInList": true
    },
    {
      "name": "refundAmount",
      "label": "Refund Amount",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "refundMode",
      "label": "Refund Mode",
      "type": "enum",
      "options": ["CASH", "CARD", "UPI", "BANK_TRANSFER", "CHEQUE"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "transactionRef",
      "label": "Transaction Reference",
      "type": "string",
      "placeholder": "Refund transaction or reference ID",
      "showInList": true
    },
    {
      "name": "refundReason",
      "label": "Reason for Refund",
      "type": "enum",
      "options": ["CANCELLED_APPOINTMENT", "BILLING_ERROR", "RETURNED_MEDICINE", "INSURANCE_ADJUSTMENT", "OTHER"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "processedBy",
      "label": "Processed By",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "email",
      "showInList": true
    },
    {
      "name": "refundDate",
      "label": "Refund Date",
      "type": "datetime",
      "required": true,
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["PENDING", "APPROVED", "REJECTED", "COMPLETED"],
      "default": "PENDING",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "remarks",
      "label": "Remarks / Notes",
      "type": "text",
      "placeholder": "Add comments or reason for approval/rejection",
      "showInList": false
    },
    {
      "name": "attachment",
      "label": "Proof of Refund",
      "type": "file",
      "multiple": false,
      "showInList": false
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "invoices",
      "type": "ManyToOne",
      "foreignKey": "invoiceId"
    },
    {
      "entity": "payments",
      "type": "ManyToOne",
      "foreignKey": "paymentId"
    },
    {
      "entity": "patients",
      "type": "ManyToOne",
      "foreignKey": "patientId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "processedBy"
    }
  ],

  "ui": {
    "listView": {
      "title": "Refund List",
      "columns": ["invoiceId", "patientId", "refundAmount", "refundMode", "status", "refundDate"],
      "filters": ["status", "refundMode", "refundReason"],
      "searchFields": ["patientId", "transactionRef"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Initiate Refund",
      "layout": [
        ["invoiceId", "paymentId"],
        ["patientId", "refundAmount"],
        ["refundMode", "refundReason"],
        ["transactionRef"],
        ["refundDate", "status"],
        ["remarks"],
        ["attachment"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Refund Details",
      "sections": [
        {
          "title": "Transaction Details",
          "fields": ["invoiceId", "paymentId", "refundAmount", "refundMode", "refundReason"]
        },
        {
          "title": "Processing Info",
          "fields": ["processedBy", "refundDate", "status", "remarks"]
        },
        {
          "title": "Proof & Audit",
          "fields": ["attachment", "createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "approveRefund",
      "label": "Approve Refund",
      "type": "update",
      "endpoint": "/api/refunds/:id/status",
      "method": "PUT",
      "payload": { "status": "APPROVED" },
      "successMessage": "Refund approved successfully."
    },
    {
      "id": "rejectRefund",
      "label": "Reject Refund",
      "type": "update",
      "endpoint": "/api/refunds/:id/status",
      "method": "PUT",
      "payload": { "status": "REJECTED" },
      "successMessage": "Refund request rejected."
    },
    {
      "id": "markCompleted",
      "label": "Mark as Completed",
      "type": "update",
      "endpoint": "/api/refunds/:id/status",
      "method": "PUT",
      "payload": { "status": "COMPLETED" },
      "successMessage": "Refund marked as completed."
    }
  ],

  "reasoning": {
    "businessLogic": "Refund management ensures financial integrity by properly tracking patient reimbursements. Each refund links to invoices and payments for clear traceability and audit compliance.",
    "uiLogic": "Users can filter refunds by mode, reason, and status. The approval workflow ensures accountability while keeping the interface aligned with billing and accounting dashboards."
  }
}
