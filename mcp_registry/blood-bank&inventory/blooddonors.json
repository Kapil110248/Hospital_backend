{
  "id": "blooddonors",
  "title": "Blood Donors",
  "description": "Registry for managing blood donors, their donation history, eligibility status, and linkage with blood inventory for traceability and compliance.",
  "entity": "BloodDonor",
  "icon": "droplets",
  "version": "1.0.0",
  "module": "Blood Bank Management",

  "permissions": {
    "view": ["Admin", "LabTechnician", "Phlebotomist"],
    "create": ["Admin", "LabTechnician"],
    "edit": ["Admin", "LabTechnician"],
    "delete": ["Admin"]
  },

  "api": {
    "base": "/api/bloodbank/donors",
    "endpoints": {
      "list": { "method": "GET", "path": "/" },
      "get": { "method": "GET", "path": "/:id" },
      "create": { "method": "POST", "path": "/" },
      "update": { "method": "PUT", "path": "/:id" },
      "delete": { "method": "DELETE", "path": "/:id" },
      "eligible": { "method": "GET", "path": "/eligibility/check" }
    }
  },

  "fields": [
    { "name": "id", "label": "Donor ID", "type": "uuid", "primary": true, "autoGenerated": true },

    {
      "name": "donorCode",
      "label": "Donor Code",
      "type": "string",
      "unique": true,
      "required": true,
      "placeholder": "Auto-generated unique donor code (e.g., BD-0001)",
      "showInList": true
    },
    {
      "name": "fullName",
      "label": "Full Name",
      "type": "string",
      "required": true,
      "placeholder": "Enter donor's full name",
      "showInList": true
    },
    {
      "name": "gender",
      "label": "Gender",
      "type": "enum",
      "options": ["Male", "Female", "Other"],
      "widget": "select",
      "showInList": true
    },
    {
      "name": "dateOfBirth",
      "label": "Date of Birth",
      "type": "date",
      "required": true
    },
    {
      "name": "age",
      "label": "Age",
      "type": "computed",
      "formula": "floor((today - dateOfBirth) / 365)",
      "showInList": true
    },
    {
      "name": "bloodGroup",
      "label": "Blood Group",
      "type": "enum",
      "options": ["A+", "A-", "B+", "B-", "O+", "O-", "AB+", "AB-"],
      "required": true,
      "widget": "select",
      "showInList": true
    },
    {
      "name": "contactNumber",
      "label": "Phone Number",
      "type": "string",
      "placeholder": "+91 9876543210",
      "validation": { "pattern": "^[0-9]{10,15}$" },
      "showInList": true
    },
    {
      "name": "email",
      "label": "Email",
      "type": "email",
      "placeholder": "donor@example.com"
    },
    {
      "name": "address",
      "label": "Address",
      "type": "text",
      "widget": "textarea"
    },
    {
      "name": "lastDonationDate",
      "label": "Last Donation Date",
      "type": "date",
      "showInList": true
    },
    {
      "name": "nextEligibleDate",
      "label": "Next Eligible Donation Date",
      "type": "computed",
      "formula": "addDays(lastDonationDate, 90)",
      "showInList": true
    },
    {
      "name": "totalDonations",
      "label": "Total Donations",
      "type": "number",
      "default": 0,
      "readOnly": true
    },
    {
      "name": "eligibilityStatus",
      "label": "Eligibility Status",
      "type": "enum",
      "options": ["Eligible", "Not Eligible", "Deferred"],
      "default": "Eligible",
      "showInList": true
    },
    {
      "name": "medicalNotes",
      "label": "Medical Notes",
      "type": "text",
      "widget": "textarea"
    },
    {
      "name": "registeredAt",
      "label": "Registered At",
      "type": "datetime",
      "default": "now",
      "readOnly": true,
      "showInList": true
    },
    { "name": "updatedAt", "label": "Updated At", "type": "datetime", "readOnly": true }
  ],

  "relations": [
    {
      "entity": "bloodinventory",
      "type": "OneToMany",
      "foreignKey": "donorId"
    }
  ],

  "ui": {
    "listView": {
      "title": "Blood Donor Directory",
      "columns": ["donorCode", "fullName", "bloodGroup", "contactNumber", "lastDonationDate", "eligibilityStatus"],
      "filters": ["bloodGroup", "eligibilityStatus"],
      "searchFields": ["donorCode", "fullName", "contactNumber", "bloodGroup"],
      "actions": ["view", "edit", "delete", "checkEligibility"]
    },
    "formView": {
      "title": "Add / Edit Donor Profile",
      "layout": [
        ["donorCode", "fullName", "gender", "dateOfBirth", "age"],
        ["bloodGroup", "contactNumber", "email"],
        ["address"],
        ["lastDonationDate", "nextEligibleDate", "eligibilityStatus"],
        ["medicalNotes"]
      ],
      "actions": ["save", "reset", "cancel"]
    },
    "detailView": {
      "title": "Donor Details",
      "sections": [
        {
          "title": "Personal Info",
          "fields": ["fullName", "gender", "dateOfBirth", "bloodGroup", "contactNumber", "email"]
        },
        {
          "title": "Donation History",
          "fields": ["lastDonationDate", "nextEligibleDate", "totalDonations", "eligibilityStatus"]
        },
        {
          "title": "Medical & Contact",
          "fields": ["address", "medicalNotes"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "checkEligibility",
      "label": "Check Eligibility",
      "type": "action",
      "method": "GET",
      "endpoint": "/api/bloodbank/donors/:id/eligibility",
      "successMessage": "Eligibility verified successfully"
    },
    {
      "id": "recordDonation",
      "label": "Record Donation",
      "type": "action",
      "method": "POST",
      "endpoint": "/api/bloodbank/donations",
      "bodyTemplate": {
        "donorId": "{{id}}",
        "bloodGroup": "{{bloodGroup}}",
        "donationDate": "now"
      },
      "successMessage": "Donation recorded and inventory updated"
    }
  ],

  "businessLogic": {
    "rules": [
      "Donor must be at least 18 years old and medically fit to donate.",
      "Next eligible date = last donation date + 90 days.",
      "Eligibility automatically updates to 'Not Eligible' if last donation was within 90 days.",
      "Donation recording automatically increments total donations and updates inventory stock.",
      "Deferral status can be manually applied by lab staff for temporary ineligibility."
    ]
  },

  "reasoning": {
    "businessLogic": "The donor registry ensures safe, traceable, and compliant blood donations. Eligibility rules and medical notes prevent unsafe or premature donations.",
    "uiLogic": "Lab technicians can quickly verify eligibility and record donations without navigating multiple modules."
  }
}
