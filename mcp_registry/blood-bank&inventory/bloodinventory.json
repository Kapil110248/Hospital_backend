{
  "id": "bloodinventory",
  "title": "Blood Inventory",
  "description": "Tracks blood units available in the blood bank, including donor linkage, blood type, storage, expiry, and status for cross-matching and issue tracking.",
  "entity": "BloodInventory",
  "icon": "test-tube",
  "version": "1.0.0",
  "module": "Blood Bank Management",

  "permissions": {
    "view": ["Admin", "LabTechnician", "Phlebotomist"],
    "create": ["LabTechnician", "Admin"],
    "edit": ["LabTechnician", "Admin"],
    "delete": ["Admin"]
  },

  "api": {
    "base": "/api/bloodbank/inventory",
    "endpoints": {
      "list": { "method": "GET", "path": "/" },
      "get": { "method": "GET", "path": "/:id" },
      "create": { "method": "POST", "path": "/" },
      "update": { "method": "PUT", "path": "/:id" },
      "delete": { "method": "DELETE", "path": "/:id" },
      "lowStock": { "method": "GET", "path": "/alerts/low-stock" },
      "nearExpiry": { "method": "GET", "path": "/alerts/near-expiry" }
    }
  },

  "fields": [
    { "name": "id", "label": "Unit ID", "type": "uuid", "primary": true, "autoGenerated": true },

    {
      "name": "unitCode",
      "label": "Unit Code",
      "type": "string",
      "unique": true,
      "required": true,
      "placeholder": "Auto-generated unique blood unit code (e.g., BLD-2025-0001)",
      "showInList": true
    },
    {
      "name": "donorId",
      "label": "Donor",
      "type": "relation",
      "relationEntity": "blooddonors",
      "relationField": "fullName",
      "widget": "select",
      "showInList": true
    },
    {
      "name": "bloodGroup",
      "label": "Blood Group",
      "type": "enum",
      "options": ["A+", "A-", "B+", "B-", "O+", "O-", "AB+", "AB-"],
      "required": true,
      "widget": "select",
      "showInList": true
    },
    {
      "name": "volume",
      "label": "Volume (ml)",
      "type": "number",
      "default": 450,
      "required": true,
      "showInList": true
    },
    {
      "name": "collectionDate",
      "label": "Collection Date",
      "type": "date",
      "required": true,
      "showInList": true
    },
    {
      "name": "expiryDate",
      "label": "Expiry Date",
      "type": "date",
      "computed": true,
      "formula": "addDays(collectionDate, 42)",
      "showInList": true
    },
    {
      "name": "storageLocation",
      "label": "Storage Location",
      "type": "string",
      "placeholder": "Refrigerator / Rack No.",
      "showInList": true
    },
    {
      "name": "componentType",
      "label": "Component Type",
      "type": "enum",
      "options": ["Whole Blood", "Plasma", "Platelets", "RBC", "Cryoprecipitate"],
      "default": "Whole Blood",
      "widget": "select",
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["Available", "Reserved", "Issued", "Expired", "Quarantined"],
      "default": "Available",
      "showInList": true
    },
    {
      "name": "screeningStatus",
      "label": "Screening Status",
      "type": "enum",
      "options": ["Pending", "Passed", "Failed"],
      "default": "Pending",
      "widget": "select",
      "showInList": true
    },
    {
      "name": "screeningRemarks",
      "label": "Screening Remarks",
      "type": "text",
      "widget": "textarea"
    },
    {
      "name": "linkedRequestId",
      "label": "Linked Request",
      "type": "relation",
      "relationEntity": "bloodrequests",
      "relationField": "requestCode",
      "widget": "select"
    },
    {
      "name": "linkedIssueId",
      "label": "Linked Issuance",
      "type": "relation",
      "relationEntity": "bloodissuance",
      "relationField": "issueCode",
      "widget": "select"
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": false
    },
    { "name": "updatedAt", "label": "Updated At", "type": "datetime", "readOnly": true }
  ],

  "relations": [
    { "entity": "blooddonors", "type": "ManyToOne", "foreignKey": "donorId" },
    { "entity": "bloodrequests", "type": "ManyToOne", "foreignKey": "linkedRequestId" },
    { "entity": "bloodissuance", "type": "OneToOne", "foreignKey": "linkedIssueId" }
  ],

  "ui": {
    "listView": {
      "title": "Blood Inventory Overview",
      "columns": ["unitCode", "bloodGroup", "componentType", "volume", "status", "expiryDate", "storageLocation"],
      "filters": ["bloodGroup", "componentType", "status", "screeningStatus"],
      "searchFields": ["unitCode", "bloodGroup", "storageLocation"],
      "actions": ["view", "edit", "delete", "markExpired"]
    },
    "formView": {
      "title": "Add / Edit Blood Unit",
      "layout": [
        ["unitCode", "bloodGroup", "componentType", "volume"],
        ["donorId", "collectionDate", "expiryDate"],
        ["storageLocation", "status", "screeningStatus"],
        ["screeningRemarks"]
      ],
      "actions": ["save", "reset", "cancel"]
    },
    "detailView": {
      "title": "Blood Unit Details",
      "sections": [
        {
          "title": "Basic Info",
          "fields": ["unitCode", "bloodGroup", "componentType", "volume", "collectionDate", "expiryDate"]
        },
        {
          "title": "Storage & Status",
          "fields": ["storageLocation", "status", "screeningStatus", "screeningRemarks"]
        },
        {
          "title": "Donor & Linkages",
          "fields": ["donorId", "linkedRequestId", "linkedIssueId"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "markExpired",
      "label": "Mark as Expired",
      "type": "action",
      "method": "PATCH",
      "endpoint": "/api/bloodbank/inventory/:id/status",
      "body": { "status": "Expired" },
      "confirmation": "Are you sure you want to mark this unit as expired?",
      "successMessage": "Unit marked as expired successfully"
    },
    {
      "id": "quarantineUnit",
      "label": "Move to Quarantine",
      "type": "action",
      "method": "PATCH",
      "endpoint": "/api/bloodbank/inventory/:id/status",
      "body": { "status": "Quarantined" },
      "successMessage": "Unit moved to quarantine section"
    }
  ],

  "businessLogic": {
    "rules": [
      "Each donation adds a new inventory record with auto-generated unitCode.",
      "Expiry = collectionDate + 42 days; after expiry, unit cannot be issued.",
      "Screening must be marked as 'Passed' before unit becomes Available for issue.",
      "If unit marked 'Issued', itâ€™s linked to a Blood Issuance record.",
      "If stock for a specific blood group < 5 units, trigger low-stock alert."
    ]
  },

  "reasoning": {
    "businessLogic": "Ensures complete traceability from donor to issued blood unit. Auto expiry logic prevents unsafe transfusions.",
    "uiLogic": "Technicians can manage stock visually with expiry and screening filters; admins track inventory status for compliance."
  }
}
