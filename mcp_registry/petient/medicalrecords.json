{
  "id": "medicalrecords",
  "title": "Medical Records",
  "description": "Maintains comprehensive patient medical history, including diagnosis, test results, prescriptions, and attachments.",
  "route": "/patients/medicalrecords",
  "icon": "FileHeart",
  "entity": "MedicalRecord",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Doctor", "Nurse"],
    "create": ["Doctor"],
    "edit": ["Doctor"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/medicalrecords",
    "get": "/api/medicalrecords/:id",
    "create": "/api/medicalrecords",
    "update": "/api/medicalrecords/:id",
    "delete": "/api/medicalrecords/:id",
    "byPatient": "/api/medicalrecords/patient/:patientId"
  },

  "fields": [
    { "name": "id", "label": "Record ID", "type": "uuid", "autoGenerated": true, "primary": true },
    { "name": "patientId", "label": "Patient", "type": "relation", "relationEntity": "patients", "relationField": "fullName", "required": true, "showInList": true },
    { "name": "doctorId", "label": "Doctor", "type": "relation", "relationEntity": "doctors", "relationField": "fullName", "required": true, "showInList": true },
    { "name": "appointmentId", "label": "Appointment", "type": "relation", "relationEntity": "appointments", "relationField": "appointmentCode", "showInList": false },
    { "name": "diagnosis", "label": "Diagnosis", "type": "textarea", "placeholder": "Describe patient diagnosis", "required": true, "showInList": true },
    { "name": "symptoms", "label": "Symptoms", "type": "textarea", "placeholder": "Patient symptoms before diagnosis", "showInList": false },
    { "name": "prescriptions", "label": "Prescriptions", "type": "relation-multi", "relationEntity": "prescriptions", "relationField": "medicineName", "showInList": false },
    { "name": "labRequests", "label": "Lab Requests", "type": "relation-multi", "relationEntity": "labrequests", "relationField": "testName", "showInList": false },
    { "name": "radiologyReports", "label": "Radiology Reports", "type": "relation-multi", "relationEntity": "radiologyreports", "relationField": "reportType", "showInList": false },
    { "name": "attachments", "label": "Documents / Reports", "type": "file-multi", "accept": [".pdf", ".jpg", ".png", ".docx"], "showInList": false },
    { "name": "followUpRequired", "label": "Follow-up Required", "type": "boolean", "default": false, "widget": "toggle", "showInList": true },
    { "name": "followUpDate", "label": "Follow-up Date", "type": "date", "showInList": true },
    { "name": "status", "label": "Status", "type": "enum", "options": ["OPEN", "CLOSED", "IN_PROGRESS"], "default": "OPEN", "widget": "badge", "showInList": true },
    { "name": "createdAt", "label": "Created At", "type": "datetime", "readOnly": true, "showInList": true },
    { "name": "updatedAt", "label": "Updated At", "type": "datetime", "readOnly": true }
  ],

  "relations": [
    { "entity": "patients", "type": "ManyToOne", "foreignKey": "patientId" },
    { "entity": "doctors", "type": "ManyToOne", "foreignKey": "doctorId" },
    { "entity": "appointments", "type": "ManyToOne", "foreignKey": "appointmentId" },
    { "entity": "prescriptions", "type": "OneToMany", "foreignKey": "recordId" },
    { "entity": "labrequests", "type": "OneToMany", "foreignKey": "recordId" },
    { "entity": "radiologyreports", "type": "OneToMany", "foreignKey": "recordId" }
  ],

  "ui": {
    "listView": {
      "title": "Patient Medical Records",
      "columns": ["patientId", "doctorId", "diagnosis", "followUpRequired", "followUpDate", "status"],
      "filters": ["doctorId", "status", "followUpRequired"],
      "searchFields": ["patientId", "diagnosis"],
      "actions": ["view", "edit", "delete"]
    },

    "formView": {
      "title": "Add / Edit Medical Record",
      "layout": [
        ["patientId", "doctorId", "appointmentId"],
        ["diagnosis"],
        ["symptoms"],
        ["prescriptions", "labRequests", "radiologyReports"],
        ["attachments"],
        ["followUpRequired", "followUpDate"],
        ["status"]
      ],
      "actions": [
        {
          "id": "saveMedicalRecord",
          "label": "Save Record",
          "type": "submit",
          "endpoint": "/api/medicalrecords",
          "method": "POST",
          "successMessage": "Medical record saved successfully!"
        },
        { "id": "cancel", "label": "Cancel", "type": "cancel" }
      ]
    },

    "detailView": {
      "title": "Medical Record Details",
      "sections": [
        {
          "title": "General Info",
          "fields": ["patientId", "doctorId", "appointmentId", "status"]
        },
        {
          "title": "Diagnosis & Symptoms",
          "fields": ["diagnosis", "symptoms"]
        },
        {
          "title": "Linked Reports",
          "fields": ["prescriptions", "labRequests", "radiologyReports"]
        },
        {
          "title": "Documents",
          "fields": ["attachments"]
        },
        {
          "title": "Follow-up",
          "fields": ["followUpRequired", "followUpDate"]
        },
        {
          "title": "Timestamps",
          "fields": ["createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "createFollowUp",
      "label": "Create Follow-up",
      "type": "link",
      "to": "/patients/followups/new?patientId={{patientId}}&doctorId={{doctorId}}"
    },
    {
      "id": "viewLabResults",
      "label": "View Lab Results",
      "type": "link",
      "to": "/labrequests?patientId={{patientId}}"
    },
    {
      "id": "downloadAllReports",
      "label": "Download All Reports",
      "type": "action",
      "endpoint": "/api/medicalrecords/{{id}}/download",
      "method": "GET",
      "successMessage": "Reports downloaded successfully!"
    }
  ],

  "reasoning": {
    "businessLogic": "The medical record serves as the central reference for all patient health data. It combines clinical information, prescriptions, and test results. Each record supports follow-up planning and clinical audits.",
    "uiLogic": "The medical records UI provides a full view of patient history in a structured way. Doctors can attach files, link lab reports, and set follow-up reminders from a single dashboard."
  }
}
