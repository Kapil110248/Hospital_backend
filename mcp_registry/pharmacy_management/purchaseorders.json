{
  "id": "pharmacystock",
  "title": "Pharmacy Stock",
  "description": "Tracks batch-wise stock of medicines, expiry dates, quantities, and supplier information.",
  "entity": "PharmacyStock",
  "icon": "package",
  "version": "1.0.0",
  "module": "Pharmacy Management",
  "permissions": {
    "view": ["Admin", "Pharmacist", "Auditor"],
    "create": ["Admin", "Pharmacist"],
    "edit": ["Admin", "Pharmacist"],
    "delete": ["Admin"]
  },
  "api": {
    "base": "/api/pharmacy/stock",
    "endpoints": {
      "list": { "method": "GET", "path": "/" },
      "get": { "method": "GET", "path": "/:id" },
      "create": { "method": "POST", "path": "/" },
      "update": { "method": "PUT", "path": "/:id" },
      "delete": { "method": "DELETE", "path": "/:id" },
      "lowStock": { "method": "GET", "path": "/alerts/low-stock" },
      "expiry": { "method": "GET", "path": "/alerts/expiry" }
    }
  },
  "fields": [
    { "name": "id", "label": "Stock ID", "type": "uuid", "primary": true, "autoGenerated": true },
    {
      "name": "medicineId",
      "label": "Medicine",
      "type": "relation",
      "relationEntity": "medicines",
      "relationField": "medicineName",
      "widget": "select",
      "required": true,
      "showInList": true
    },
    { "name": "batchNumber", "label": "Batch Number", "type": "string", "required": true, "showInList": true },
    { "name": "manufactureDate", "label": "Manufacture Date", "type": "date", "required": true },
    { "name": "expiryDate", "label": "Expiry Date", "type": "date", "required": true, "showInList": true },
    { "name": "quantityReceived", "label": "Quantity Received", "type": "number", "required": true },
    { "name": "quantityAvailable", "label": "Quantity Available", "type": "number", "readonly": true, "default": 0, "showInList": true },
    { "name": "reorderThreshold", "label": "Reorder Threshold", "type": "number", "default": 10 },
    {
      "name": "supplierId",
      "label": "Supplier",
      "type": "relation",
      "relationEntity": "suppliers",
      "relationField": "name",
      "widget": "select",
      "showInList": true
    },
    {
      "name": "purchaseOrderId",
      "label": "Purchase Order",
      "type": "relation",
      "relationEntity": "purchaseorders",
      "relationField": "orderNumber",
      "widget": "select"
    },
    { "name": "unitCost", "label": "Unit Cost (₹)", "type": "number", "min": 0, "step": "0.01", "showInList": true },
    { "name": "totalCost", "label": "Total Cost (₹)", "type": "computed", "formula": "quantityReceived * unitCost", "showInList": true },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["Available", "Low Stock", "Near Expiry", "Expired"],
      "default": "Available",
      "showInList": true
    },
    { "name": "remarks", "label": "Remarks / Notes", "type": "text", "widget": "textarea" },
    { "name": "createdAt", "label": "Created At", "type": "datetime", "readOnly": true },
    { "name": "updatedAt", "label": "Updated At", "type": "datetime", "readOnly": true }
  ],
  "relations": [
    { "entity": "medicines", "type": "ManyToOne", "foreignKey": "medicineId" },
    { "entity": "suppliers", "type": "ManyToOne", "foreignKey": "supplierId" },
    { "entity": "purchaseorders", "type": "ManyToOne", "foreignKey": "purchaseOrderId" },
    { "entity": "pharmacysales", "type": "OneToMany", "foreignKey": "stockId" }
  ],
  "ui": {
    "listView": {
      "title": "Pharmacy Stock Overview",
      "columns": ["medicineId", "batchNumber", "quantityAvailable", "expiryDate", "status", "supplierId"],
      "filters": ["status", "supplierId"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Add / Edit Stock Batch",
      "layout": [
        ["medicineId", "batchNumber"],
        ["manufactureDate", "expiryDate"],
        ["quantityReceived", "unitCost", "totalCost"],
        ["supplierId", "purchaseOrderId"],
        ["reorderThreshold", "status"],
        ["remarks"]
      ],
      "actions": ["save", "reset", "cancel"]
    },
    "detailView": {
      "title": "Batch Details",
      "sections": [
        { "title": "Batch Info", "fields": ["medicineId", "batchNumber", "quantityReceived", "quantityAvailable", "expiryDate", "status"] },
        { "title": "Supplier & Cost", "fields": ["supplierId", "purchaseOrderId", "unitCost", "totalCost"] },
        { "title": "Dates & Metadata", "fields": ["manufactureDate", "createdAt", "updatedAt"] }
      ]
    }
  },
  "actions": [
    {
      "id": "recalculateStock",
      "label": "Recalculate Stock Quantity",
      "type": "action",
      "method": "POST",
      "endpoint": "/api/pharmacy/stock/:id/recalculate",
      "successMessage": "Stock quantity recalculated successfully"
    },
    {
      "id": "markExpired",
      "label": "Mark as Expired",
      "type": "action",
      "method": "PATCH",
      "endpoint": "/api/pharmacy/stock/:id/status",
      "body": { "status": "Expired" },
      "confirmation": "Mark this batch as expired?",
      "successMessage": "Batch marked as expired"
    }
  ],
  "businessLogic": {
    "rules": [
      "If expiryDate < today → status = 'Expired' and block sale.",
      "If expiryDate within 30 days → status = 'Near Expiry'.",
      "If quantityAvailable < reorderThreshold → status = 'Low Stock' and trigger alert.",
      "TotalCost = quantityReceived × unitCost."
    ]
  },
  "reasoning": {
    "businessLogic": "Each stock batch enables audit-ready tracking of quantities and expiry. Alerts prevent stock-outs and expired medicines.",
    "uiLogic": "Pharmacists manage batches visually; admins use filters to review low or expired stock."
  }
}
