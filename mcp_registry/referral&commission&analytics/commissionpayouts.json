{
  "id": "commissionpayouts",
  "title": "Commission Payouts",
  "description": "Tracks and manages payouts to referral partners, doctors, or affiliates based on configured commission structures and completed transactions.",
  "route": "/commission/payouts",
  "icon": "Wallet",
  "entity": "CommissionPayout",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant"],
    "create": ["Admin", "Accountant"],
    "edit": ["Admin"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/commissionpayouts",
    "get": "/api/commissionpayouts/:id",
    "create": "/api/commissionpayouts",
    "update": "/api/commissionpayouts/:id",
    "delete": "/api/commissionpayouts/:id",
    "generate": "/api/commissionpayouts/generate"
  },

  "fields": [
    {
      "name": "id",
      "label": "Payout ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "transactionId",
      "label": "Commission Transaction",
      "type": "relation",
      "relationEntity": "commissiontransactions",
      "relationField": "referenceNo",
      "required": true,
      "showInList": true
    },
    {
      "name": "payeeType",
      "label": "Payee Type",
      "type": "enum",
      "options": ["DOCTOR", "REFERRAL_PARTNER", "AFFILIATE"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "payeeId",
      "label": "Payee Reference",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "fullName",
      "showInList": true
    },
    {
      "name": "payoutAmount",
      "label": "Payout Amount",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "payoutDate",
      "label": "Payout Date",
      "type": "datetime",
      "required": true,
      "showInList": true
    },
    {
      "name": "paymentMethod",
      "label": "Payment Method",
      "type": "enum",
      "options": ["BANK_TRANSFER", "CASH", "UPI", "CHECK"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "referenceNo",
      "label": "Payment Reference Number",
      "type": "string",
      "placeholder": "e.g. UTR/NEFT/Transaction ID",
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["PENDING", "PROCESSED", "FAILED"],
      "default": "PENDING",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "remarks",
      "label": "Remarks / Notes",
      "type": "text",
      "placeholder": "Optional payout notes or comments",
      "showInList": false
    },
    {
      "name": "createdBy",
      "label": "Created By",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "email",
      "showInList": true
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "commissiontransactions",
      "type": "ManyToOne",
      "foreignKey": "transactionId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "payeeId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "createdBy"
    }
  ],

  "ui": {
    "listView": {
      "title": "Commission Payout List",
      "columns": [
        "transactionId",
        "payeeType",
        "payeeId",
        "payoutAmount",
        "paymentMethod",
        "status",
        "payoutDate"
      ],
      "filters": ["payeeType", "status", "paymentMethod"],
      "searchFields": ["referenceNo", "payeeId"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Record Payout",
      "layout": [
        ["transactionId", "payeeType"],
        ["payeeId", "payoutAmount"],
        ["payoutDate", "paymentMethod"],
        ["referenceNo"],
        ["status"],
        ["remarks"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Payout Details",
      "sections": [
        {
          "title": "Transaction Info",
          "fields": ["transactionId", "payeeType", "payeeId", "payoutAmount", "paymentMethod", "payoutDate"]
        },
        {
          "title": "Audit Information",
          "fields": ["referenceNo", "status", "remarks", "createdBy", "createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "markProcessed",
      "label": "Mark as Processed",
      "type": "update",
      "endpoint": "/api/commissionpayouts/:id/status",
      "method": "PUT",
      "payload": { "status": "PROCESSED" },
      "successMessage": "Payout marked as processed successfully!"
    },
    {
      "id": "generatePayout",
      "label": "Auto Generate Payouts",
      "type": "custom",
      "endpoint": "/api/commissionpayouts/generate",
      "method": "POST",
      "successMessage": "Payouts generated for all pending commission transactions."
    }
  ],

  "reasoning": {
    "businessLogic": "Commission payouts automate the settlement process for referral partners and medical staff. It ensures accurate payment tracking and audit logging for financial compliance.",
    "uiLogic": "The UI allows accountants to filter payouts by status, date, or payee type. Buttons for 'Mark Processed' and 'Generate Payouts' simplify workflow automation."
  }
}
