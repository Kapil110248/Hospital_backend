{
  "id": "commissiontransactions",
  "title": "Commission Transactions",
  "description": "Tracks individual commission earnings generated from hospital services based on defined commission setup rules. Each transaction represents an earning event before payout.",
  "route": "/commission/transactions",
  "icon": "ReceiptText",
  "entity": "CommissionTransaction",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant"],
    "create": ["System", "Admin"],
    "edit": ["Admin"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/commissiontransactions",
    "get": "/api/commissiontransactions/:id",
    "create": "/api/commissiontransactions",
    "update": "/api/commissiontransactions/:id",
    "delete": "/api/commissiontransactions/:id",
    "generate": "/api/commissiontransactions/generate"
  },

  "fields": [
    {
      "name": "id",
      "label": "Transaction ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "referenceNo",
      "label": "Reference Number",
      "type": "string",
      "placeholder": "e.g., CTX-2025-001",
      "required": true,
      "unique": true,
      "showInList": true
    },
    {
      "name": "commissionSetupId",
      "label": "Commission Rule",
      "type": "relation",
      "relationEntity": "commissionsetups",
      "relationField": "ruleName",
      "required": true,
      "showInList": true
    },
    {
      "name": "serviceType",
      "label": "Service Type",
      "type": "enum",
      "options": ["CONSULTATION", "LAB_TEST", "PHARMACY_SALE", "ADMISSION", "SURGERY", "OTHER"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "serviceRefId",
      "label": "Linked Service Reference",
      "type": "string",
      "placeholder": "Invoice or Service ID",
      "required": true,
      "showInList": true
    },
    {
      "name": "payeeType",
      "label": "Payee Type",
      "type": "enum",
      "options": ["DOCTOR", "NURSE", "REFERRAL_PARTNER", "PHARMACIST"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "payeeId",
      "label": "Payee Reference",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "fullName",
      "showInList": true
    },
    {
      "name": "transactionAmount",
      "label": "Transaction Amount (₹)",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "commissionValue",
      "label": "Commission Earned (₹)",
      "type": "currency",
      "required": true,
      "showInList": true
    },
    {
      "name": "commissionRate",
      "label": "Commission Rate (%)",
      "type": "number",
      "required": true,
      "showInList": true
    },
    {
      "name": "earnedDate",
      "label": "Date Earned",
      "type": "datetime",
      "required": true,
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["PENDING", "APPROVED", "PAID", "CANCELLED"],
      "default": "PENDING",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "remarks",
      "label": "Remarks / Notes",
      "type": "text",
      "placeholder": "Optional comments",
      "showInList": false
    },
    {
      "name": "createdBy",
      "label": "Created By",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "email",
      "showInList": true
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "commissionsetups",
      "type": "ManyToOne",
      "foreignKey": "commissionSetupId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "payeeId"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "createdBy"
    }
  ],

  "ui": {
    "listView": {
      "title": "Commission Transaction Log",
      "columns": [
        "referenceNo",
        "commissionSetupId",
        "serviceType",
        "payeeType",
        "commissionValue",
        "status",
        "earnedDate"
      ],
      "filters": ["serviceType", "status", "payeeType"],
      "searchFields": ["referenceNo", "payeeId"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Add Commission Transaction",
      "layout": [
        ["referenceNo", "commissionSetupId"],
        ["serviceType", "serviceRefId"],
        ["payeeType", "payeeId"],
        ["transactionAmount", "commissionRate"],
        ["commissionValue"],
        ["earnedDate"],
        ["status"],
        ["remarks"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Commission Transaction Details",
      "sections": [
        {
          "title": "Transaction Info",
          "fields": ["referenceNo", "serviceType", "serviceRefId", "transactionAmount", "commissionRate", "commissionValue"]
        },
        {
          "title": "Payee Details",
          "fields": ["payeeType", "payeeId"]
        },
        {
          "title": "Audit Info",
          "fields": ["status", "earnedDate", "createdBy", "createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "approveTransaction",
      "label": "Approve Commission",
      "type": "update",
      "endpoint": "/api/commissiontransactions/:id/status",
      "method": "PUT",
      "payload": { "status": "APPROVED" },
      "successMessage": "Commission transaction approved."
    },
    {
      "id": "markAsPaid",
      "label": "Mark as Paid",
      "type": "update",
      "endpoint": "/api/commissiontransactions/:id/status",
      "method": "PUT",
      "payload": { "status": "PAID" },
      "successMessage": "Commission transaction marked as paid."
    },
    {
      "id": "generateCommissions",
      "label": "Auto Generate Commissions",
      "type": "custom",
      "endpoint": "/api/commissiontransactions/generate",
      "method": "POST",
      "successMessage": "Commissions generated for all eligible services."
    }
  ],

  "reasoning": {
    "businessLogic": "Each service completed in the hospital may trigger one or more commission transactions, depending on applicable commission setup rules. This ensures traceability and transparency in earnings before payouts.",
    "uiLogic": "The UI presents a color-coded transaction log with filters by service type, status, and payee. Accountants can approve, pay, or cancel transactions directly from the grid."
  }
}
