{
  "id": "referralcodes",
  "title": "Referral Codes",
  "description": "Manages unique referral codes assigned to partners, doctors, or affiliates for patient referrals and commission tracking.",
  "route": "/commission/referralcodes",
  "icon": "Share2",
  "entity": "ReferralCode",
  "version": "1.0.0",

  "permissions": {
    "view": ["Admin", "Accountant", "Receptionist"],
    "create": ["Admin"],
    "edit": ["Admin"],
    "delete": ["Admin"]
  },

  "api": {
    "list": "/api/referralcodes",
    "get": "/api/referralcodes/:id",
    "create": "/api/referralcodes",
    "update": "/api/referralcodes/:id",
    "delete": "/api/referralcodes/:id",
    "validate": "/api/referralcodes/validate/:code"
  },

  "fields": [
    {
      "name": "id",
      "label": "Referral ID",
      "type": "uuid",
      "primary": true,
      "autoGenerated": true
    },
    {
      "name": "code",
      "label": "Referral Code",
      "type": "string",
      "placeholder": "e.g., DRK12345",
      "required": true,
      "unique": true,
      "showInList": true
    },
    {
      "name": "ownerType",
      "label": "Owner Type",
      "type": "enum",
      "options": ["DOCTOR", "REFERRAL_PARTNER", "AFFILIATE"],
      "widget": "select",
      "required": true,
      "showInList": true
    },
    {
      "name": "ownerId",
      "label": "Owner Reference",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "fullName",
      "required": true,
      "showInList": true
    },
    {
      "name": "linkedDepartment",
      "label": "Linked Department",
      "type": "relation",
      "relationEntity": "departments",
      "relationField": "name",
      "showInList": true
    },
    {
      "name": "discountType",
      "label": "Discount Type",
      "type": "enum",
      "options": ["PERCENTAGE", "FIXED"],
      "default": "PERCENTAGE",
      "widget": "radio",
      "showInList": true
    },
    {
      "name": "discountValue",
      "label": "Discount Value",
      "type": "number",
      "required": true,
      "min": 0,
      "placeholder": "Enter discount (e.g., 10 or 500)",
      "showInList": true
    },
    {
      "name": "commissionPercent",
      "label": "Commission Percentage (%)",
      "type": "number",
      "default": 5,
      "showInList": true
    },
    {
      "name": "usageLimit",
      "label": "Usage Limit",
      "type": "number",
      "default": 0,
      "placeholder": "0 = unlimited",
      "showInList": true
    },
    {
      "name": "usedCount",
      "label": "Times Used",
      "type": "number",
      "readOnly": true,
      "default": 0,
      "showInList": true
    },
    {
      "name": "validFrom",
      "label": "Valid From",
      "type": "date",
      "required": true,
      "showInList": true
    },
    {
      "name": "validTo",
      "label": "Valid To",
      "type": "date",
      "showInList": true
    },
    {
      "name": "status",
      "label": "Status",
      "type": "enum",
      "options": ["ACTIVE", "EXPIRED", "DISABLED"],
      "default": "ACTIVE",
      "widget": "badge",
      "showInList": true
    },
    {
      "name": "createdBy",
      "label": "Created By",
      "type": "relation",
      "relationEntity": "users",
      "relationField": "email",
      "showInList": true
    },
    {
      "name": "createdAt",
      "label": "Created At",
      "type": "datetime",
      "readOnly": true,
      "showInList": true
    },
    {
      "name": "updatedAt",
      "label": "Updated At",
      "type": "datetime",
      "readOnly": true
    }
  ],

  "relations": [
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "ownerId"
    },
    {
      "entity": "departments",
      "type": "ManyToOne",
      "foreignKey": "linkedDepartment"
    },
    {
      "entity": "users",
      "type": "ManyToOne",
      "foreignKey": "createdBy"
    }
  ],

  "ui": {
    "listView": {
      "title": "Referral Code Directory",
      "columns": [
        "code",
        "ownerType",
        "ownerId",
        "discountType",
        "discountValue",
        "commissionPercent",
        "usedCount",
        "status"
      ],
      "filters": ["ownerType", "status"],
      "searchFields": ["code", "ownerId"],
      "actions": ["view", "edit", "delete"]
    },
    "formView": {
      "title": "Add / Edit Referral Code",
      "layout": [
        ["code", "ownerType"],
        ["ownerId", "linkedDepartment"],
        ["discountType", "discountValue"],
        ["commissionPercent"],
        ["usageLimit", "validFrom", "validTo"],
        ["status"]
      ],
      "actions": ["save", "cancel"]
    },
    "detailView": {
      "title": "Referral Code Details",
      "sections": [
        {
          "title": "Code & Owner Info",
          "fields": ["code", "ownerType", "ownerId", "linkedDepartment"]
        },
        {
          "title": "Discount & Commission",
          "fields": ["discountType", "discountValue", "commissionPercent"]
        },
        {
          "title": "Usage & Validity",
          "fields": ["usageLimit", "usedCount", "validFrom", "validTo", "status"]
        },
        {
          "title": "Audit Trail",
          "fields": ["createdBy", "createdAt", "updatedAt"]
        }
      ]
    }
  },

  "actions": [
    {
      "id": "deactivateCode",
      "label": "Deactivate Code",
      "type": "update",
      "endpoint": "/api/referralcodes/:id/status",
      "method": "PUT",
      "payload": { "status": "DISABLED" },
      "successMessage": "Referral code disabled successfully."
    },
    {
      "id": "reactivateCode",
      "label": "Reactivate Code",
      "type": "update",
      "endpoint": "/api/referralcodes/:id/status",
      "method": "PUT",
      "payload": { "status": "ACTIVE" },
      "successMessage": "Referral code reactivated successfully."
    },
    {
      "id": "validateCode",
      "label": "Validate Referral Code",
      "type": "custom",
      "endpoint": "/api/referralcodes/validate/:code",
      "method": "GET",
      "successMessage": "Referral code validated successfully."
    }
  ],

  "reasoning": {
    "businessLogic": "Referral codes are used for tracking patient acquisition sources and automating commission calculations. Each code belongs to a user and can be linked to departments or services.",
    "uiLogic": "The interface allows admins to manage referral codes with filters for status and owner type. Validation endpoints ensure codes are active and within the valid date range before use."
  }
}